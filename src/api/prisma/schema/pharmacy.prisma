model PharmacyChain {
  id        String   @id @default(cuid())
  name      String
  legalName String?
  website   String?
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  pharmacies  Pharmacy[]
  partnerOrgs PartnerOrg[]

  @@unique([name])
}

model Pharmacy {
  id        String  @id @default(cuid())
  chainId   String?
  name      String
  logoUrl   String?
  addressId String
  phone     String?
  email     String?
  website   String?
  isActive  Boolean @default(true)

  confirmSlaMinutes Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  chain   PharmacyChain? @relation(fields: [chainId], references: [id], onDelete: SetNull)
  address Address        @relation(fields: [addressId], references: [id], onDelete: Restrict)

  workingHours PharmacyWorkingHour[]
  service      PharmacyService?
  verification PharmacyVerification?

  offers       Offer[]
  reservations Reservation[]

  paymentMethods        PharmacyPaymentMethod[]
  access                PartnerUserPharmacyAccess[]
  addressChangeRequests AddressChangeRequest[]

  reviews               PharmacyReview[]
  reviewReports         PharmacyReviewReport[]
  reviewReportResponses PharmacyReviewReportResponse[]

  ratingAvg             Decimal?              @default(0)
  ratingCount           Int                   @default(0)
  pharmacyReviewReplies PharmacyReviewReply[]

  conversations PharmacyConversation[]

  @@index([chainId])
  @@index([addressId])
}

model PharmacyWorkingHour {
  id          String  @id @default(cuid())
  pharmacyId  String
  dayOfWeek   Int
  isClosed    Boolean @default(false)
  openMinute  Int?
  closeMinute Int?

  pharmacy Pharmacy @relation(fields: [pharmacyId], references: [id], onDelete: Cascade)

  @@unique([pharmacyId, dayOfWeek])
  @@index([pharmacyId])
}

model PharmacyService {
  id         String @id @default(cuid())
  pharmacyId String @unique

  is24x7       Boolean @default(false)
  hasDelivery  Boolean @default(false)
  hasPickup    Boolean @default(true)
  canSplitPack Boolean @default(false)
  notes        String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  pharmacy Pharmacy @relation(fields: [pharmacyId], references: [id], onDelete: Cascade)
}

model PharmacyVerification {
  id         String @id @default(cuid())
  pharmacyId String @unique

  status VerificationStatus @default(PENDING)
  note   String?

  checkedByUserId String?
  checkedAt       DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  pharmacy  Pharmacy @relation(fields: [pharmacyId], references: [id], onDelete: Cascade)
  checkedBy User?    @relation("PharmacyVerificationCheckedBy", fields: [checkedByUserId], references: [id], onDelete: SetNull)

  @@index([status])
}
