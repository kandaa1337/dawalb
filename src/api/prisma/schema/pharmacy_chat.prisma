model PharmacyConversation {
  id         String   @id @default(cuid())
  pharmacyId String
  userId     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  pharmacy Pharmacy                    @relation(fields: [pharmacyId], references: [id], onDelete: Cascade)
  user     User                        @relation("PharmacyConversationAsUser", fields: [userId], references: [id], onDelete: Cascade)
  messages PharmacyConversationMessage[]

  @@unique([pharmacyId, userId])
  @@index([pharmacyId])
  @@index([userId])
}

model PharmacyConversationMessage {
  id             String   @id @default(cuid())
  conversationId String
  senderUserId   String
  body           String
  createdAt      DateTime @default(now())

  conversation PharmacyConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User                 @relation("PharmacyConversationMessageSender", fields: [senderUserId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderUserId])
}
